{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Profile</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
        <style>
        /* âœ… Matching the Professionals Section Styling */
        body {
            background: linear-gradient(to right, #ffffff, #e3f2fd);
            font-family: 'Arial', sans-serif;
        }
        .profile-card {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        .profile-header {
            background: #1f4870;
            color: white;
            padding: 50px 20px;
            border-radius: 15px 15px 0 0;
        }
        .profile-img {
            width: 140px;
            height: 140px;
            object-fit: cover;
            border: 4px solid white;
            margin-top: -70px;
            border-radius: 50%;
        }
        .info-item {
            font-size: 1.1rem;
            color: #555;
        }
        .book-appointment-btn {
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: bold;
            color: #fff !important;
            background: linear-gradient(135deg, #1f4870, #163754) !important;
            border: none;
            border-radius: 30px;
            transition: all 0.3s ease-in-out;
        }
        .book-appointment-btn:hover {
            transform: scale(1.05);
            box-shadow: 0px 6px 12px rgba(31, 72, 112, 0.4);
        }
        /* âœ… Available Slots Styling */
        .slots-container {
    display: flex;
    flex-direction: column; /* Stacks buttons vertically */
    align-items: center; /* Centers buttons */
    gap: 10px; /* Adds spacing between buttons */
}

.slot-btn {
    display: block; /* Forces each button to take a new line */
    width: 100%; /* Ensures full width for proper stacking */
    max-width: 200px; /* Limits width so buttons don't stretch too much */
    padding: 10px 15px;
    font-size: 1rem;
    font-weight: bold;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background-color: #1f4870;
    color: white;
    transition: all 0.3s ease-in-out;
    text-align: center;
}


        .slot-btn:hover {
            background-color: #1f4870;
        }
        .slot-btn.booked {
            background-color: #dc3545;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* âœ… Styled Success Message */
        .success-popup {
            display: none;
            background: #28a745;
            color: white;
            padding: 15px;
            position: fixed;
            top: 20px;
            right: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            width: auto;
            max-width: 300px;
        }
        
        .success-popup a {
            color: #ffd700;
            font-weight: bold;
            text-decoration: underline;
        }

        .success-popup a:hover {
            color: #fff;
        }
        /* âœ… Align Specialty, Email, and Phone Number Justified */
.profile-info {
    text-align: justify;
    padding: 10px 20px;
}

/* âœ… Ensure Contact Information Displays Neatly */
.info-item {
    display: block;
    text-align: justify;
    word-break: break-word; /* Prevents text from overflowing */
    font-size: 1.1rem;
    color: #555;
    margin-bottom: 10px;
}
/* âœ… Hide extra slots initially */
.hidden-slots {
    display: none; /* Initially hidden */
    flex-direction: column; /* Ensures vertical layout */
    align-items: center;
}


/* âœ… Style for "See More" / "Show Less" button */
#toggle-slots-btn {
    background: #1f4870;
    color: white;
    font-weight: bold;
    padding: 8px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    margin-top: 10px;
}

#toggle-slots-btn:hover {
    background: #163754;
    transform: scale(1.05);
}
.slots-title {
    font-size: 1.2rem; /* Slightly larger text */
    font-weight: bold;
    color: #1f4870; /* Dark blue color to match theme */
    text-align: center; /* Center the text */
    margin-bottom: 10px; /* Add space before the buttons */
}
/* âœ… Style the Modal */
.modal-content {
    background-color: #f8f9fa; /* Light background for contrast */
    border-radius: 15px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    border: none;
}

/* âœ… Style the Modal Header */
.modal-header {
    background: linear-gradient(135deg, #1f4870, #163754); /* Main theme color */
    color: white;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
    text-align: center;
    padding: 15px;
}

/* âœ… Close Button */
.modal-header .btn-close {
    filter: invert(1); /* Makes the close button white */
}

/* âœ… Style the Modal Title */
.modal-title {
    font-size: 1.4rem;
    font-weight: bold;
}

/* âœ… Style the Modal Body */
.modal-body {
    padding: 20px;
    text-align: left;
}

/* âœ… Form Elements */
.modal-body label {
    font-weight: bold;
    color: #1f4870; /* Theme color */
}

.modal-body .form-control, 
.modal-body .form-select {
    border-radius: 8px;
    border: 1px solid #1f4870; /* Subtle border */
}

/* âœ… Style the Submit Button */
.modal-body button[type="submit"] {
    background: linear-gradient(135deg, #1f4870, #163754); /* Theme color */
    color: white;
    font-weight: bold;
    padding: 12px;
    border-radius: 8px;
    border: none;
    transition: all 0.3s ease-in-out;
}

.modal-body button[type="submit"]:hover {
    transform: scale(1.05);
    box-shadow: 0px 4px 8px rgba(31, 72, 112, 0.4);
}

/* âœ… Style the Success Message Popup */
.success-popup {
    background: #1f4870; /* Theme color */
    color: white;
    padding: 15px;
    position: fixed;
    top: 20px;
    right: 20px;
    border-radius: 10px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    max-width: 300px;
}

.success-popup a {
    color: #ffd700;
    font-weight: bold;
    text-decoration: underline;
}

.success-popup a:hover {
    color: #fff;
}
/* âœ… Style the See More button container */
.see-more-container {
    display: flex;
    justify-content: center;
    margin-top: 10px; /* Adds spacing below the last slot */
}

/* âœ… Style the "See More" button */
#toggle-slots-btn {
    background: linear-gradient(135deg, #1f4870, #163754); /* Theme color */
    color: white;
    font-weight: bold;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    width: auto; /* Avoids full-width stretching */
}

#toggle-slots-btn:hover {
    background: #163754;
    transform: scale(1.05);
}


    </style>
    <div id="google_translate_element"></div>
</head>
<body>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="profile-card">
                    
                    <div class="profile-header">
                        <h1>{{ professional.name }}</h1>
                    </div>
                    
                    <div>
                        {% if professional.image %}
                            <img src="{{ professional.image.url }}" class="profile-img" alt="{{ professional.name }}">
                        {% else %}
                            <img src="{% static 'images/default-profile.png' %}" class="profile-img" alt="Default Profile">
                        {% endif %}
                    </div>

                    <div class="profile-info">
                        <p class="info-item"><strong>Specialty:</strong> {{ professional.specialty }}</p>
                        <p class="info-item"><strong>Email:</strong> {{ professional.contact_email }}</p>
                        <p class="info-item"><strong>Phone:</strong> {{ professional.phone_number }}</p>
                        
                        {% if user.is_authenticated %}
                        <div class="profile-info">
                            <p class="slots-title"><strong>Available Slots:</strong></p> <!-- Title added here -->
                            
                            <div class="slots-container">
                                {% for slot in professional.available_slots %}
                                    {% if slot not in professional.booked_slots %}
                                        <button class="slot-btn {% if forloop.counter > 3 %}hidden-slots{% endif %}" onclick="selectSlot('{{ slot }}')">
                                            {{ slot }}
                                        </button>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            
                            <!-- Move the "See More" button directly below the slots -->
                            {% if professional.available_slots|length > 4 %}
                                <div class="see-more-container">
                                    <button id="toggle-slots-btn" onclick="toggleSlots()">See More</button>
                                </div>
                            {% endif %}
                            
                            
                            {% if not professional.available_slots or professional.available_slots|length == professional.booked_slots|length %}
                                <p style="color: red; font-weight: bold;">No available slots</p>
                            {% endif %}
                        </div>
                    {% endif %}
                    {% if user.is_authenticated %}

                        <button class="book-appointment-btn mt-3" onclick="openBookingModal()">ðŸ“… Book Appointment</button>
                    {% endif %}    
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- âœ… Booking Modal -->
    <div id="appointment-modal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Book Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="appointment-form">
                        {% csrf_token %}
                        <p>Booking with: <strong>{{ professional.name }}</strong></p>

                        <label for="appointment-date" class="form-label">Select Date:</label>
                        <input type="date" class="form-control" id="appointment-date" required>

                        <label for="appointment-time" class="form-label">Select Time:</label>
                        <select class="form-select" id="appointment-time" required></select>

                        <label for="reason" class="form-label">Reason:</label>
                        <textarea class="form-control" id="reason" placeholder="Enter appointment reason" required></textarea>

                        <button type="submit" class="btn btn-primary mt-3 w-100">Confirm Appointment</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… Success Message -->
    <div id="success-popup" class="success-popup">
        <p>âœ… Appointment confirmed!</p>
        <p>Join your session using the link below:</p>
        <a id="meet-link" href="#" target="_blank">Join Google Meet</a>
    </div>
<!-- Appointment Booking Modal -->
<div id="appointment-modal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Book Appointment</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="appointment-form">
            {% csrf_token %}
            <input type="hidden" name="professional" id="modal-professional-id">
  
            <p>Booking with: <strong id="modal-professional-name"></strong></p>
            <p>Specialty: <span id="modal-specialty"></span></p>
  
            <div class="mb-3">
              <label for="date" class="form-label">Select Date:</label>
              <input type="date" class="form-control" name="date" id="appointment-date" required>
            </div>
  
            <div class="mb-3">
              <label for="time" class="form-label">Select Time:</label>
              <select class="form-select" name="time" id="appointment-time" required>
              </select>
            </div>
  
            <div class="mb-3">
              <label for="reason" class="form-label">Reason:</label>
              <textarea class="form-control" name="reason" placeholder="Enter appointment reason" required></textarea>
            </div>
  
            <button type="submit" class="btn btn-primary w-100">Confirm Appointment</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Success Message -->
  <div id="success-popup" style="display: none; background: green; color: white; padding: 15px; position: fixed; top: 20px; right: 20px; border-radius: 5px; z-index: 1000;">
    Appointment confirmed! A Google Meet link has been sent to your email.  
    <br>
    <a id="meet-link" href="#" style="color: yellow; font-weight: bold;" target="_blank"></a>
  </div>
  <script>
document.addEventListener("DOMContentLoaded", function () {
    let today = new Date().toISOString().split("T")[0];
    document.getElementById("appointment-date").setAttribute("min", today);

    // âœ… Open Modal & Populate Available Slots
    document.querySelectorAll(".book-appointment-btn").forEach(button => {
        button.addEventListener("click", function () {
            let professionalId = "{{ professional.id }}";
            let professionalName = "{{ professional.name }}";
            let specialty = "{{ professional.specialty }}";
            
            let availableSlots = [];
            document.querySelectorAll(".slot-btn").forEach(btn => {
                if (!btn.classList.contains("booked")) {
                    availableSlots.push(btn.innerText);
                }
            });

            document.getElementById("modal-professional-id").value = professionalId;
            document.getElementById("modal-professional-name").textContent = professionalName;
            document.getElementById("modal-specialty").textContent = specialty;

            let timeSelect = document.getElementById("appointment-time");
            timeSelect.innerHTML = "";

            if (availableSlots.length === 0) {
                let option = document.createElement("option");
                option.textContent = "No available slots";
                option.disabled = true;
                option.selected = true;
                timeSelect.appendChild(option);
            } else {
                availableSlots.forEach(slot => {
                    let option = document.createElement("option");
                    option.value = slot;
                    option.textContent = slot;
                    timeSelect.appendChild(option);
                });
            }

            let modalElement = document.getElementById("appointment-modal");
            let modalInstance = new bootstrap.Modal(modalElement);
            modalInstance.show();
        });
    });

    // âœ… Handle Appointment Form Submission
    document.getElementById("appointment-form").addEventListener("submit", function (event) {
        event.preventDefault();

        let formData = new FormData(this);
        let selectedSlot = formData.get("time");
        let professionalId = formData.get("professional");
        let submitButton = this.querySelector("button[type='submit']");
        
        submitButton.disabled = true;
        submitButton.textContent = "Booking...";

        fetch("{% url 'book_appointment' %}", {
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                let meetLink = data.google_meet_link;

                // âœ… Close the Modal
                let modalElement = document.getElementById("appointment-modal");
                let modalInstance = bootstrap.Modal.getInstance(modalElement);
                if (modalInstance) {
                    modalInstance.hide();
                }

                // âœ… Ensure backdrop removal for proper UI
                setTimeout(() => {
                    document.querySelectorAll(".modal-backdrop").forEach(backdrop => backdrop.remove());
                    document.body.classList.remove("modal-open");
                    document.body.style.overflow = "auto";
                }, 500);

                // âœ… Remove Booked Slot from UI
                document.querySelectorAll(".slot-btn").forEach(btn => {
                    if (btn.innerText === selectedSlot) {
                        btn.classList.add("booked");
                        btn.innerText += " - Booked";
                        btn.disabled = true;
                    }
                });

                // âœ… Show Success Message
                let successPopup = document.getElementById("success-popup");
                document.getElementById("meet-link").href = meetLink;
                document.getElementById("meet-link").textContent = "Join Google Meet";
                successPopup.style.display = "block";

                setTimeout(() => {
                    successPopup.style.display = "none";
                }, 5000);
            }
        })
        .catch(error => {
            console.error("Error booking appointment:", error);
            alert("Error booking appointment. Please try again.");
        })
        .finally(() => {
            submitButton.disabled = false;
            submitButton.textContent = "Confirm Appointment";
        });
    });
});
function toggleSlots() {
    let hiddenSlots = document.querySelectorAll(".hidden-slots");
    let toggleButton = document.getElementById("toggle-slots-btn");

    if (toggleButton.innerText === "See More") {
        hiddenSlots.forEach(slot => {
            slot.style.display = "block"; /* Show hidden slots */
        });
        toggleButton.innerText = "Show Less";
    } else {
        hiddenSlots.forEach(slot => {
            slot.style.display = "none"; /* Hide them again */
        });
        toggleButton.innerText = "See More";
    }
}



</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- to your js part -->
<script src="script.js"></script>
      <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement(
                {pageLanguage: 'en'},
                'google_translate_element'
            );
        } 
  </script>
  <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
